<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Seasons' Choir Tracking</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#6C5CE7">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Firebase & Custom Scripts -->
    <script src="firebase-config.js"></script>
    <script type="module" src="firebase-service.js"></script>
</head>
<body>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js');
        }
    </script>
    <div id="login-screen" class="login-screen visible">
        <div class="login-box">
            <img src="logo_asc.png" alt="ASC Logo" class="login-logo">
            <h2>Track Attendance</h2>
            <p>Please sign in with your Google account to access the choir tracker.</p>
            <button id="google-login-btn" class="google-login-btn">
                <svg viewBox="0 0 48 48" width="24" height="24"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/><path fill="none" d="M0 0h48v48H0z"/></svg>
                <span>Sign in with Google</span>
            </button>
        </div>
    </div>

    <div id="app">
        <!-- Header -->
        <header class="main-header">
            <div class="header-top">
                <img src="logo_asc.png" alt="ASC Logo" class="app-logo">
                <div class="login-container">

                    <div id="user-profile-card" class="profile-card-empty">
                        <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                    </div>
                </div>
            </div>
            <div class="header-content swipe-area" id="header-swipe">
                <button class="date-nav-btn prev" id="prev-date">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M15 18l-6-6 6-6"/></svg>
                </button>
                <div class="header-titles">
                    <span class="label-mini" id="page-label">Attendance</span>
                    <h1 id="page-title" class="clickable-title" spellcheck="false">Loading Date...</h1>
                    <input type="date" id="header-date-picker" class="hidden-date-input">
                </div>
                <button class="date-nav-btn next" id="next-date">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M9 18l6-6-6-6"/></svg>
                </button>
            </div>
            <input type="text" id="day-title-input" placeholder="Practice / Serve / etc." class="day-title-input">
        </header>

        <!-- Main Content Area -->
        <main id="content">
            <div id="transition-wrapper" class="transition-wrapper peek-center">
                

                <!-- Analytics Charts -->
                <div id="analytics-container" class="analytics-container">
                    <div class="chart-card" id="sunday-chart-card">
                        <span class="chart-label">Sunday Services</span>
                        <canvas id="sundayChart"></canvas>
                    </div>
                    <div class="chart-card" id="practice-chart-card">
                        <span class="chart-label">Practices</span>
                        <canvas id="practiceChart"></canvas>
                    </div>
                </div>
                <!-- Attendance Summary Card (Inside scroll area) -->
                <div id="attendance-summary" class="summary-card">
                    <div class="summary-item">
                        <span class="summary-value" id="summary-present">0</span>
                        <span class="summary-label">Present</span>
                    </div>
                    <div class="summary-divider"></div>
                    <div class="summary-item">
                        <span class="summary-value" id="summary-absent">0</span>
                        <span class="summary-label">Absent</span>
                    </div>
                    <div class="summary-divider"></div>
                    <div class="summary-item">
                        <span class="summary-value" id="summary-exempt">0</span>
                        <span class="summary-label">Exempted</span>
                    </div>
                </div>
                <!-- Attendance Section (Default) -->
                <section id="attendance-section" class="page-content active">
                    <div class="voice-tabs-container">
                        <div class="voice-tabs">
                            <button class="voice-tab active" data-voice="all">All</button>
                            <button class="voice-tab" data-voice="Soprano">Soprano</button>
                            <button class="voice-tab" data-voice="Alto">Alto</button>
                            <button class="voice-tab" data-voice="Tenor">Tenor</button>
                            <button class="voice-tab" data-voice="Bass">Bass</button>
                            <button class="voice-tab" data-voice="mostly-absent">Mostly Absent</button>
                            <button class="voice-tab" data-voice="at-cebu">At Cebu</button>
                        </div>
                    </div>
                    <div class="search-bar">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" width="18" height="18"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
                        <input type="text" id="member-search" placeholder="Search by name or ID...">
                    </div>
                    <div class="selection-controls">
                        <label class="checkbox-container-label">
                            <input type="checkbox" id="select-all">
                            <span id="select-all-label">Select All</span>
                        </label>
                        <span class="member-count">0 Members</span>
                    </div>
                    
                    <div id="attendance-list">
                        <!-- Dynamic Member Groups -->
                    </div>
                </section>

                <!-- Calendar Section -->
                <section id="calendar-section" class="page-content">
                    <div class="calendar-container">
                        <div id="calendar-grid" class="calendar-grid"></div>
                    </div>
                </section>

                <!-- Finance Section -->
                <section id="finance-section" class="page-content">
                    <div id="transaction-history"></div>
                </section>

                <!-- Members Section -->
                <section id="members-section" class="page-content">
                    <div id="members-list"></div>
                </section>
            </div>

        </main>

        <!-- Scroll to Top -->
        <button id="scroll-top" class="scroll-top-btn" title="Back to Top">
            <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="3"><path d="M18 15l-6-6-6 6"/></svg>
        </button>

        <!-- Floating Action Button (Save) -->
        <button class="fab" id="save-attendance" title="Save Attendance">
            <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="3.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
        </button>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <div class="nav-item active" data-target="attendance-section">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2"/><rect x="9" y="3" width="6" height="4" rx="1"/><path d="M10 12l2 2 4-4"/></svg>
                <span>Attendance</span>
            </div>
            <div class="nav-item" data-target="calendar-section">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/><path d="M8 14h.01M12 14h.01M16 14h.01M8 18h.01M12 18h.01M16 18h.01"/></svg>
                <span>Events</span>
            </div>
            <div class="nav-item" data-target="finance-section">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="2" y="6" width="20" height="12" rx="2"/><circle cx="12" cy="12" r="2"/><path d="M6 12h.01M18 12h.01"/></svg>
                <span>Finance</span>
            </div>
            <div class="nav-item" data-target="members-section">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                <span>Members</span>
            </div>
        </nav>
    </div>

    <script src="app.js"></script>
</body>
</html>
